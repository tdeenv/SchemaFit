<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SchemaFit</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 1em; }
    .exercise, .set { border: 1px solid #ccc; padding: 0.75em; margin-bottom: 1em; }
    .exercise { background: #f9f9f9; }
    .set { background: #fff; margin-left: 1em; }
    button { margin-top: 0.5em; }
  </style>
</head>
<body>
  <h1>SchemaFit</h1>
  <a href="/history"><button type="button">View History</button></a>
  <form action="/" method="post" id="workout-form">
    <!-- Date Picker -->
    <label for="date">Date:</label><br>
    <input type="date" id="date" name="date" required><br><br>

    <!-- Workout Type -->
    <label for="workout_type">Workout Type:</label><br>
    <input type="text" id="workout_type" name="workout_type" required><br><br>

    <!-- Body Measurements -->
    <label>Body Weight (kg):</label><br>
    <input type="number" step="0.1" name="weight"><br>
    <label>Arm (cm):</label><br>
    <input type="number" step="0.1" name="arm"><br>
    <label>Neck (cm):</label><br>
    <input type="number" step="0.1" name="neck"><br>
    <label>Quad (cm):</label><br>
    <input type="number" step="0.1" name="quad"><br>
    <label>Waist (cm):</label><br>
    <input type="number" step="0.1" name="waist"><br><br>

    <!-- Exercises Container -->
    <div id="exercises-container"></div>
    <button type="button" onclick="addExercise()">+ Add Exercise</button><br><br>

    <button type="submit">Save Workout</button>
  </form>

  <template id="exercise-template">
    <div class="exercise">
      <label>Exercise Name:</label><br>
      <input type="text" name="exercise_name[]" required><br>
      <div class="sets-container"></div>
      <button type="button" onclick="addSet(this)">+ Add Set</button>
      <button type="button" onclick="removeExercise(this)">Remove Exercise</button>
    </div>
  </template>

  <template id="set-template">
    <div class="set">
      <label>Weight (kg):</label>
      <input type="number" step="0.1" name="set_weight[]" required>
      <label>Reps:</label>
      <input type="number" name="reps[]" required>
      <label>Comment:</label>
      <input type="text" name="comment[]">
      <input type="hidden" name="set_exercise_index[]" class="set-index">
      <button type="button" onclick="removeSet(this)">âœ•</button>
    </div>
  </template>

  <script>
    function updateSetIndexes() {
      document.querySelectorAll('.exercise').forEach((exerciseDiv, exIndex) => {
        exerciseDiv.querySelectorAll('.set-index').forEach(input => {
          input.value = exIndex;
        });
      });
    }

    function addExercise() {
      const tpl = document.getElementById('exercise-template').content.cloneNode(true);
      const setNode = document.getElementById('set-template').content.cloneNode(true);
      tpl.querySelector('.sets-container').appendChild(setNode);
      document.getElementById('exercises-container').appendChild(tpl);
      updateSetIndexes();
    }

    function addSet(btn) {
      const exerciseDiv = btn.closest('.exercise');
      const setsContainer = exerciseDiv.querySelector('.sets-container');
      const setNode = document.getElementById('set-template').content.cloneNode(true);
      setsContainer.appendChild(setNode);
      updateSetIndexes();
    }

    function removeExercise(btn) {
      btn.closest('.exercise').remove();
      updateSetIndexes();
    }

    function removeSet(btn) {
      btn.closest('.set').remove();
      updateSetIndexes();
    }

    // Add one exercise on page load
    window.onload = addExercise;
  </script>
</body>
</html>
